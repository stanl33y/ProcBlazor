@page "/cadastro"
@using ProcBlazor.Domain.Entities
@inject NavigationManager NavigationManager
@inject HttpClient HttpClient

<h3>Cadastro de Usuário</h3>

<EditForm Model="cadastroModel" OnValidSubmit="HandleCadastro">
    <DataAnnotationsValidator />
    <ValidationSummary />
    <div class="form-group">
        <label>Nome:</label>
        <InputText id="nome" @bind-Value="cadastroModel.Nome" class="form-control" />
    </div>
    <div class="form-group">
        <label>Email:</label>
        <InputText id="email" @bind-Value="cadastroModel.Email" class="form-control" />
    </div>
    <div class="form-group">
        <label>Senha:</label>
        <InputText id="senha" @bind-Value="cadastroModel.Senha" type="password" class="form-control" />
    </div>
    <p class="alert alert-danger pt-1">@erro</p>
    <button type="submit" class="btn btn-primary">Cadastrar</button>
</EditForm>

@code {
    private Usuario cadastroModel = new Usuario();

    private string erro = string.Empty;

    private async Task HandleCadastro()
    {
        var response = await HttpClient.PostAsJsonAsync("api/v1/usuario", cadastroModel);
        if (response.IsSuccessStatusCode)
        {
            NavigationManager.NavigateTo("/login");
        }
        else
        {
            erro = "Erro ao cadastrar usuário";
        }
    }
}